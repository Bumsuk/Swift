# Memory Allocation

메모리는 기본적으로 데이터를 저장하는 공간입니다. CPU가 데이터를 연산하고 처리하는 장치라면 메모리는 입력 및 출력 데이터를 저장하는 역할을 합니다. 이러한 메모리는 물리적 혹은 기능적으로 구분하고는 합니다.

#### 물리적 메모리 구분

- ##### 하드디스크

: 전원이 꺼져도 데이터는 남아있어 반 영구적으로 데이터를 소장할 수 있습니다. 다만 처리속도가 느립니다.

- ##### 램

: 처리속도가 매우 빠르고 하드디스크와는 다르게 전원이 꺼지면 데이터가 날아가는 특성이 있습니다. 이러한 특성 때문에 보통 프로그램은 하드디스크에 저장되어 있다가 프로그램이 실행되는 순간 램으로 탑제되어 CPU의 연산을 보조하는 메모리로서의 역할을 합니다.

- ##### 레지스터와 캐시

: CPU 칩 안의 메모리 입니다. 램보다도 처리속도가 빠르기 때문에 CPU를 좀더 가까운 거리에서 보좌해줍니다.


#### 기능적 (가상) 메모리 구분

**정적할당:** 변수선언을 통해 컴파일시 필요한 메모리를 확보하는 방법입니다. 메모리의 크기가 하드 코딩되어 있기 때문에 프로그램이 실행 될 때 이미 해당 메모리의 크기가 결정되는 것이 특징입니다. 해제하지 않음으로 인한 메모리 누수와 같은 문제를 신경쓰지 않아도 된다. 정적 할당된 메모리는 실행 도중에 해제되지 않고, 프로그램이 종료할 때 알아서 운영 체제가 회수합니다. 메모리의 크기가 하드 코딩되어 있어서 나중에 조절 할 수 없다. 동적 할당에 비해 할당 받을 수 있는 최대 메모리에 제약을 받습니다.

**동적할당:** 프로그램 실행 도중, 동적으로 필요한 메모리를 확보하는 방법입니다. 사용이 끝나면 운영체제가 쓸 수 있도록 반납하고 다음에 요구가 오면 재 할당을 받을 수 있다. 이것은 프로그램이 실행하는 순간 프로그램이 사용할 메모리 크기를 고려하여 메모리의 할당이 이루어지는 정적 메모리 할당과 대조적입니다. 상황에 따라 원하는 크기만큼의 메모리가 할당되므로 경제적이며, 이미 할당된 메모리라도 언제든지 크기를 조절할 수 있지만, 더 이상 사용하지 않을 때 명시적으로 메모리를 해제해 주어야 한다는 단점이 있습니다.

<img src="https://t1.daumcdn.net/cfile/tistory/255B4A415835396538">

- ##### Code (정적)

: 함수와 상수가 저장되는 공간입니다. 프로그램이 실행되는 중에 변하지 않으므로 정적으로 할당됩니다.

- ##### Data (정적)

: Global(전역) / Static(정적) 변수가 저장되는 공간입니다. 프로그램이 실행되는 동안 여기저기서 필요한 변수들이기 때문에 프로그램이 끝날 때까지 정적으로 할당되어 메모리에 남아있습니다.

cf) 초기화를 시키지 않은 전역/정적 변수들은 BSS 영역에 따로 저장됩니다.


- ##### Stack (정적)

: 특정 구문 내에서 임시로 할당하는 메모리 영역으로 Local(지역) / Parameter(매개) 변수가 저장되는 공간입니다. 함수의 파라미터나 함수 안에서 선언된 지역 변수들 및 리턴값이 저장됩니다. 이들은 함수가 실행될 때 메모리를 할당받아 생성되어 함수가 실행완료되면 할당받았던 메모리를 반환합니다. 이러한 변수들은 할당 시 스택에 값 자체가 저장됩니다. 함수 호출 순서에 따라 물건이 쌓이듯 (stack)  메모리에 쌓이고 나가는 구조 때문에 스택이라고 부릅니다.

스택은 CPU에 의해 관리되고 optimized됩니다. 스택의 사이즈는 컴파일시 이미 결정되기 때문에 스택에 할당된 변수들은 direct하게 메모리에 적재되고, 매우 빠르게 접근할 수 있습니다. value type의 변수가 스택에 적재됩니다.

cf) 개념상 동적으로 할당되지만 컴파일 시에 이미 결정되기 때문에 런타임에는 정적인 사이즈를 갖습니다. 



- ##### Heap (동적)

개발자가 동적으로 할당하는 영역입니다. 실행 중에 개발자가 원하는 만큼 데이터를 확보/제거 하는 유동적인 데이터 관리에 이점이 있습니다. 하지만 계속해서 할당만 받고 제고하지 않으면 결국 힙 영역에 무리가 올 수 있고, 메모리 누수가 생길 수도 있습니다. (Swift에서는 ARC로 관리합니다.)

이 영역은 메모리 주소값에 의해서만 참조되고 사용되는 영역입니다. 즉, Reference type들이 저장되는 곳 입니다. Heap은 Swift의 참조형 자료인 클래스, 클로져 등의 자료가 머무르는 공간입니다. Heap에 저장된 데이터는 모두 참조형이기 때문에 원본 데이터가 갑자기 사라지게 되면 이 원본을 참조했던 변수들에 에러가 발생합니다.  

힙에서는 스택과 같이 자동적으로 객체에 메모리를 할당 및 반환할 수 없습니다. 외부적으로 이러한 일을 해야합니다. (개발자가 직접하거나 Swift처럼 ARC, 자바의 GC 등이 이러한 일을 합니다.) 따라서 메모리 할당, 참조 추적, 메모리 반환 등의 모든 프로세스가 프로그램 런타임 동안에 일어나게 되므로 스택에 비해 느릴 수 밖에 없습니다. 이것이 value type이 reference type보다 빠른 이유입니다.



## Swift 자료형 타입

<img src = "https://cdn-images-1.medium.com/max/1600/1*6aJyC6_MrCRjdIAgXxAxkQ.png" width=500>

위에서 언급하였다시피 Reference type은 Heap에 저장됩니다.

### Reference:

- https://m.blog.naver.com/PostView.nhn?blogId=jdub7138&logNo=220916332425&proxyReferer=https%3A%2F%2Fwww.google.com%2F
